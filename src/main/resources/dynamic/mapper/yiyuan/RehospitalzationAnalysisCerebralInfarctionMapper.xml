<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.paladin.qos.dynamic.mapper.yiyuan.RehospitalzationAnalysisCerebralInfarctionMapper">

	<select id="getTotalNum" parameterType="Map" resultType="Long">
		select count(*) from outhospitalrecord
		<where>
			<!-- OHREC_DREC = '1' and IHD_DIS_CODE in (select major_code from classify_code_disease 
				where major_code like 'I60%' or major_code like 'I61%' or major_code like 
				'I62%' or major_code like 'I63%') -->
			OHREC_DREC = '1'
			and IHD_DIS_CODE in ('I61.801',
			'I63.902',
			'I61.300',
			'I61.004',
			'I63.203',
			'I63.600',
			'I61.000',
			'I60.902†',
			'I60.100',
			'I61.803',
			'I63.101',
			'I60.101',
			'I60.000',
			'I60.200',
			'I60.601',
			'I60.400',
			'I63.300',
			'I61.003',
			'I63.002',
			'I63.207',
			'I61.005',
			'I63.907',
			'I63.103',
			'I60.801',
			'I61.301',
			'I61.200',
			'I62.900',
			'I60.300',
			'I62.000',
			'I63.003',
			'I63.903',
			'I62.001',
			'I61.101',
			'I61.500',
			'I63.908',
			'I63.401',
			'I63.100',
			'I62.101',
			'I63.205',
			'I63.900',
			'I63.904',
			'I60.500',
			'I63.905',
			'I62.100',
			'I60.201',
			'I63.204',
			'I63.500',
			'I61.802',
			'I61.600',
			'I61.001',
			'I60.600',
			'I63.906',
			'I60.802',
			'I63.502',
			'I63.102',
			'I63.402',
			'I63.301',
			'I61.901',
			'I63.800',
			'I61.400',
			'I61.800',
			'I61.002',
			'I60.701',
			'I61.904',
			'I63.201',
			'I61.903',
			'I63.302',
			'I60.901',
			'I61.100',
			'I63.901',
			'I61.905',
			'I63.802',
			'I60.800',
			'I60.301',
			'I61.902',
			'I63.200',
			'I61.006',
			'I62.002',
			'I63.001',
			'I61.900',
			'I63.206',
			'I60.401',
			'I63.501',
			'I63.801',
			'I60.001',
			'I63.202',
			'I63.000',
			'I60.900',
			'I63.208',
			'I60.700',
			'I62.003',
			'I63.400')
				and OUT_HP_DT <![CDATA[>=]]>
				#{startTime}
				and OUT_HP_DT <![CDATA[<]]>
				#{endTime}
				and ORGAN_CODE = #{unitId}
		</where>
	</select>

	<select id="getEventNum" parameterType="Map" resultType="Long">
		SELECT count(*) FROM outhospitalrecord a
		where a.OHREC_DREC = '1'
		and
		a.IHD_DIS_CODE in ('I61.801',
		'I63.902',
		'I61.300',
		'I61.004',
		'I63.203',
		'I63.600',
		'I61.000',
		'I60.902†',
		'I60.100',
		'I61.803',
		'I63.101',
		'I60.101',
		'I60.000',
		'I60.200',
		'I60.601',
		'I60.400',
		'I63.300',
		'I61.003',
		'I63.002',
		'I63.207',
		'I61.005',
		'I63.907',
		'I63.103',
		'I60.801',
		'I61.301',
		'I61.200',
		'I62.900',
		'I60.300',
		'I62.000',
		'I63.003',
		'I63.903',
		'I62.001',
		'I61.101',
		'I61.500',
		'I63.908',
		'I63.401',
		'I63.100',
		'I62.101',
		'I63.205',
		'I63.900',
		'I63.904',
		'I60.500',
		'I63.905',
		'I62.100',
		'I60.201',
		'I63.204',
		'I63.500',
		'I61.802',
		'I61.600',
		'I61.001',
		'I60.600',
		'I63.906',
		'I60.802',
		'I63.502',
		'I63.102',
		'I63.402',
		'I63.301',
		'I61.901',
		'I63.800',
		'I61.400',
		'I61.800',
		'I61.002',
		'I60.701',
		'I61.904',
		'I63.201',
		'I61.903',
		'I63.302',
		'I60.901',
		'I61.100',
		'I63.901',
		'I61.905',
		'I63.802',
		'I60.800',
		'I60.301',
		'I61.902',
		'I63.200',
		'I61.006',
		'I62.002',
		'I63.001',
		'I61.900',
		'I63.206',
		'I60.401',
		'I63.501',
		'I63.801',
		'I60.001',
		'I63.202',
		'I63.000',
		'I60.900',
		'I63.208',
		'I60.700',
		'I62.003',
		'I63.400')
			and a.OUT_HP_DT <![CDATA[>=]]>
			#{startTime}
			and a.OUT_HP_DT <![CDATA[<]]>
			#{endTime}
			and ORGAN_CODE = #{unitId}
		AND EXISTS (
		SELECT * FROM outhospitalrecord b
		WHERE
		b.CARDNO = a.CARDNO
		AND b.OUT_HP_DT <![CDATA[!=]]>a.OUT_HP_DT
		and a.OUT_HP_DT <![CDATA[>=]]>(b.IN_HP_DT-31)
		and a.OUT_HP_DT <![CDATA[<]]>b.IN_HP_DT

		)
	</select>
</mapper>
